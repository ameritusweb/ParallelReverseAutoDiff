{
  "timeSteps": [
    {
      "startOperations": [
        {
          "id": "pathFeatures",
          "type": "MatrixConcatenateOperation",
          "inputs": [ "pathFeaturesArray" ]
        }
      ],
      "layers": [
        {
          "startOperations": [
            {
              "id": "keys_pathFeatures",
              "type": "CudaMatrixMultiplyOperation",
              "inputs": [ "pathFeatures", "Keys" ],
              "gradientResultTo": [ null, "DKeys" ]
            },
            {
              "id": "keypath_add",
              "type": "MatrixAddBroadcastingOperation",
              "inputs": [ "keys_pathFeatures", "KB" ],
              "gradientResultTo": [ null, "DKB" ]
            },
            {
              "id": "layernorm_keys",
              "type": "LayerNormalizationOperation",
              "inputs": [ "keypath_add" ]
            },
            {
              "id": "keys_act",
              "type": "LeakyReLUOperation",
              "inputs": [ "layernorm_keys" ]
            },
            {
              "id": "values_pathFeatures",
              "type": "CudaMatrixMultiplyOperation",
              "inputs": [ "pathFeatures", "Values" ],
              "gradientResultTo": [ null, "DValues" ]
            },
            {
              "id": "valuepath_add",
              "type": "MatrixAddBroadcastingOperation",
              "inputs": [ "values_pathFeatures", "VB" ],
              "gradientResultTo": [ null, "DVB" ]
            },
            {
              "id": "layernorm_values",
              "type": "LayerNormalizationOperation",
              "inputs": [ "valuepath_add" ]
            },
            {
              "id": "values_act",
              "type": "LeakyReLUOperation",
              "inputs": [ "layernorm_values" ]
            }
          ],
          "layers": [
            {
              "operations": [
                {
                  "id": "queries_edgeFeatures",
                  "type": "CudaMatrixMultiplyOperation",
                  "inputs": [ "pathFeatures", "Queries[layerIndex]" ],
                  "gradientResultTo": [ null, "DQueries[layerIndex]" ]
                },
                {
                  "id": "queryedge_add",
                  "type": "MatrixAddBroadcastingOperation",
                  "inputs": [ "queries_pathFeatures", "QB" ],
                  "gradientResultTo": [ null, "DQB" ]
                },
                {
                  "id": "layernorm_queries",
                  "type": "LayerNormalizationOperation",
                  "inputs": [ "querypath_add" ]
                },
                {
                  "id": "queries_act",
                  "type": "LeakyReLUOperation",
                  "inputs": [ "layernorm_queries" ]
                },
                {
                  "id": "keys_transpose",
                  "type": "MatrixTransposeOperation",
                  "inputs": [ "keys_act" ]
                },
                {
                  "id": "queries_keys_transpose",
                  "type": "CudaMatrixMultiplyOperation",
                  "inputs": [ "queries_act", "keys_transpose" ]
                },
                {
                  "id": "queries_keys_scale",
                  "type": "MatrixMultiplyScalarOperation",
                  "inputs": [ "queries_keys_transpose", "Divisor" ]
                },
                {
                  "id": "attention_weights",
                  "type": "SoftmaxOperation",
                  "inputs": [ "queries_keys_scale" ]
                },
                {
                  "id": "attention_weights_values",
                  "type": "CudaMatrixMultiplyOperation",
                  "inputs": [ "attention_weights", "values_act" ],
                  "setResultTo": "AV[layerIndex]"
                }
              ]
            }
          ],
          "endOperations": [
            {
              "id": "concatenated",
              "type": "MatrixConcatenateOperation",
              "inputs": [ "AV" ]
            },
            {
              "id": "reduce",
              "type": "CudaMatrixMultiplyOperation",
              "inputs": [ "AV", "R" ],
              "gradientResultTo": [ null, "DR" ]
            },
            {
              "id": "reduce_add",
              "type": "MatrixAddBroadcastingOperation",
              "inputs": [ "reduce", "RB" ],
              "gradientResultTo": [ null, "DRB" ]
            },
            {
              "id": "layernorm_reduce",
              "type": "LayerNormalizationOperation",
              "inputs": [ "reduce_add" ]
            },
            {
              "id": "output_act",
              "type": "LeakyReLUOperation",
              "inputs": [ "layernorm_reduce" ]
            }
          ]
        }
      ],
      "endoperations": [
        {
          "id": "output_sum",
          "type": "MatrixSumOperation",
          "inputs": [ "output_act_last" ]
        },
        {
          "id": "output_sum_trans",
          "type": "MatrixTransposeOperation",
          "inputs": [ "output_sum" ]
        },
        {
          "id": "output_sum_trans_soft",
          "type": "SoftmaxOperation",
          "inputs": [ "output_sum_trans" ]
        }
      ]
    }
  ]
}
